<ng-container *ngIf="loading || saving || authPending">
    <moo-preloader [mode]="mode" [delay]="loading && 1000"></moo-preloader>
</ng-container>

<div *ngIf="!loggedIn && showLogin" [class]="'sign-in ' + mode">
    <div>
        <moo-input [mode]="mode" [text]="email" [label]="'Email'" (valueChanged)="email = $event"></moo-input>
    </div>
    <div>
        <moo-input [mode]="mode" [text]="password" [inputType]="'password'" [label]="'Password'" (valueChanged)="password = $event"></moo-input>
    </div>
    <div>
        <a [class]="'waves-effect waves-light btn-small dark-btn ' + mode" [style.margin-right]="'7pt'" (click)="firebasePasswordLogin()">Login</a>
        <a [class]="'waves-effect waves-light btn-flat btn-small ' + mode" (click)="sendPasswordReset()">Forgot</a>
    </div>
</div>

<div class="top-nav">
    <div *ngIf="loggedIn" [class]="'management-top-nav management-hide waves-effect ' + (mode==='dark' ? 'waves-light ' : '') + mode">
        <div (click)="toggleShowManagement()">
            <div *ngIf="showManagement" [class]="'top-nav-text'">Hide</div>
            <div *ngIf="!showManagement" [class]="'top-nav-text'">Show</div>
        </div>
    </div>
    
    <div [class]="'management-top-nav management-log waves-effect ' + (mode==='dark' ? 'waves-light ' : '') + mode">
        <div *ngIf="!loggedIn" [class]="'management-top-nav management-log ' + mode" (click)="showLogin = !showLogin">
            <div *ngIf="showLogin" [class]="'top-nav-text'">Cancel</div>
        </div>
        <div *ngIf="loggedIn" [class]="'management-top-nav management-log ' + mode" (click)="logUserOut()">
            <div [class]="'top-nav-text'">Logout</div>
        </div>
    </div>
</div>

<div *ngIf="loggedIn && showManagement" [class]="'management-wrapper ' + mode">
    <div [class]="'fixed-action-btn ' + mode" (click)="save()">
        <a [class]="'btn-floating btn-large waves-effect waves-light ' + mode">
            <!-- <i class="material-icons">add</i> -->
            <!-- <div class="waves-effect editable-button"> -->
                <moo-icon [icon]="'upload'"></moo-icon>
            <!-- </div> -->
        </a>
    </div>

    <div [class]="'management-container ' + (dragging ? 'dragging' : '')" [style.color]="'black'">
        <div [class]="'management-options-container ' + mode">
            <div class="management-options wave-effect">
                <div [class]="'management-option ' + (activeManagementOption === 'projects' ? 'active' : '')" (click)="setActiveManagementOption('projects')">
                    <span>Projects</span>
                </div>
                <div [class]="'management-option ' + (activeManagementOption === 'footer' ? 'active' : '')" (click)="setActiveManagementOption('footer')">
                    <span>Footer</span>
                </div>
                <div [class]="'management-option ' + (activeManagementOption === 'tips' ? 'active' : '')" (click)="setActiveManagementOption('tips')">
                    <span>Tips</span>
                </div>
            </div>
            <div [class]="'management-option-active-border ' + mode + ' ' + 'active-' + activeManagementOption">
                <!-- active bar -->
            </div>
        </div>
        
        <ng-container *ngIf="activeManagementOption==='projects'">
            <div id="drakeTest" dragula="URLS" [(dragulaModel)]="urls" class="editables">
                <div *ngFor="let url of urls; let i = index">
                    <div class="row">
                        <div class="col s12">
                            <div class="editable-row">
                                <div [class]="'index ' + mode">
                                    {{ i + 1 }}.
                                </div>
                                <div class="inputs">
                                    <moo-input [mode]="mode" [text]="url.text" [label]="'Project name'" [textIsInvalidFuncs]="[isEmptyProject]" (valueChanged)="url.text = $event"></moo-input>
                                    <moo-input [mode]="mode" [text]="url.href" [label]="'Project url'" [textIsInvalidFuncs]="[isInvalidUrl]" (valueChanged)="url.href = $event"></moo-input>
                                </div>
                                <div class="editable-buttons">
                                    <div [class]="'editable-button waves-effect ' + (mode==='dark' ? 'waves-light' : '')" (click)="insertProject(i)">
                                        <moo-icon [class]="mode" [icon]="'add'"></moo-icon>
                                    </div>
                                    <div *ngIf="urls.length > 1" [class]="'editable-button waves-effect ' + (mode==='dark' ? 'waves-light' : '')" (click)="removeProject(i)">
                                        <moo-icon [class]="mode" [icon]="'remove'"></moo-icon>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="activeManagementOption==='footer'">
            <div dragula="FOOTERS" [(dragulaModel)]="footerUrls" class="editables">
                <div *ngFor="let url of footerUrls; let i = index">
                    <div class="row">
                        <div class="col s12">
                            <div class="editable-row">
                                <div [class]="'index ' + mode">
                                    {{ i + 1 }}.
                                </div>
                                <div class="inputs">
                                    <moo-input [mode]="mode" [text]="url.text" [label]="'Footer name'" [textIsInvalidFuncs]="[isEmptyProject]" (valueChanged)="url.text = $event"></moo-input>
                                    <moo-input [mode]="mode" [text]="url.href" [label]="'Footer url'" [textIsInvalidFuncs]="[isInvalidUrl]" (valueChanged)="url.href = $event"></moo-input>
                                </div>
                                <!-- <div class="editable-buttons">
                                    <div [class]="'waves-effect editable-button ' + (mode==='dark' ? 'waves-light' : '')">
                                        <moo-icon [class]="mode" [icon]="'add'"></moo-icon>
                                    </div>
                                    <div [class]="'waves-effect editable-button ' + (mode==='dark' ? 'waves-light' : '')">
                                        <moo-icon [class]="mode" [icon]="'remove'"></moo-icon>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="activeManagementOption==='tips'">
            <div [class]="'tips-container ' + mode">
                <span>TODO: show tips on how to make the line breaks happen (desktop vs mobile, etc)</span>
            </div>
        </ng-container>
    </div>
</div>

<ng-container *ngIf="!loading && !showManagement">
    <div class="fixed-full">
    <div *ngIf="showPoem" class="poem-container" [style.z-index]="mode === 'dark' ? 0 : 1">
    <div>
        <img [class]="'poem-image ' + mode" src="./assets/poem_desktop.png">
    </div>
    </div>

    <div (click)="toggleMode()" [class]="'center-image' + (mode !== 'dark' ? ' waves-effect waves-light' : '') + ((w <= 812 && h < 450) || (w < h && w < 750) ? ' vertical' : '')">
        <img class="dark-image" [class]="'dark-image-safari-fix dark-image' + ' ' + mode" src='./assets/dark_logo.jpeg' [src]="darkIconEncoded">
        <img class="light-image" [class]="'light-image' + ' ' + mode" src='./assets/light_logo.jpeg' [src]="lightIconEncoded">
    </div>

    <div #container id="container" [class]="mode">
    <div class="fixed-full" [style.visibility]="(w <= 812 && h < 450) || (w < h && w < 750) ? '' : 'hidden'">
        <div class="wrapper-with-margins">
        <div class="center-horizontal justify-vert title-vert title-vert-1">
            <div *ngFor="let char of header1.split('')">{{ char }}</div>
            <div [class]="'vertical-image-placeholder' + (w < h && w < 750 ? ' smaller' : '')"></div>
        </div>

        <div class="center-horizontal justify-vert title-vert title-vert-2">
            <div [class]="'vertical-image-placeholder' + (w < h && w < 750 ? ' smaller' : '')"></div>
            <div *ngFor="let char of header2.split('')">{{ char }}</div>
        </div>

        <div [class]="'mobile-text-container' + (showOthers ? ' active' : '') + (w > 420 && h > 420 ? ' with-extra-margins' : '')">
            <a *ngFor="let url of urls" #a [href]="url.href || '#'" [style.margin-bottom]="'7pt'" [class]="'themed-text mobile-text' + (!showOthers ? ' not-active' : '')" [target]="url.href ? '_blank' : ''" (click)="a.blur(); getActive(a)" (mouseleave)="getNotActive(a)">
                <ng-container *ngIf="url.text">
                    <span *ngFor="let char of url.text.split(''); let i = index" [class]="char === '\\' ? 'new-line' : ''">
                        <!-- "" -->
                        <ng-container *ngIf="char !== '\\' && (!i || url.text.split('')[i - 1] !=='\\')">
                        {{ char }}
                        </ng-container>
                        <ng-container *ngIf="i > 0 && url.text.split('')[i - 1] === '\\' && char === 's'">
                        {{ ' ' }}
                        </ng-container>
                    </span>
                </ng-container>
            </a>
        </div>

        <div [class]="'mobile-text-container mobile-text-container-footer' + (showOthers ? ' active' : '') + (w > 420 && h > 420 ? ' with-extra-margins' : '')">
            <div>
            <a *ngFor="let url of footerUrls" #a [href]="url.href || '#'" [style.margin-bottom]="'7pt'" [target]="!url.href || url.href.indexOf('mailto:') !== -1 || url.href.indexOf('tel:') !== -1 ? '' : '_blank'" [class]="'themed-text mobile-text' + (!showOthers ? ' not-active' : '')" (click)="a.blur(); getActive(a)" (mouseleave)="getNotActive(a)">
                <span *ngFor="let char of url.text.split(''); let i = index" [class]="char === '\\' ? 'new-line' : ''">
                <!-- "" -->
                <ng-container *ngIf="char !== '\\' && (!i || url.text.split('')[i - 1] !=='\\')">
                    {{ char }}
                </ng-container>
                <ng-container *ngIf="i > 0 && url.text.split('')[i - 1] === '\\' && char === 's'">
                    {{ ' ' }}
                </ng-container>
                </span>
            </a>
            </div>
        </div>
        </div>
    </div>

    <div class="fixed-full" [style.visibility]="(w > 812 || h >= 450) && (w >= h  || w >= 750) ? '' : 'hidden'">
        <div class="center-vert title-container">

        <div class="center-vert title title-1">
            <div>
            <span *ngFor="let char of header1.split('')">{{ char }}</span>
            <span class="image-placeholder"></span>
            </div>
        </div>

        <div class="center-vert title title-2">
            <div>
            <span class="image-placeholder"></span>
            <span *ngFor="let char of header2.split('')">{{ char }}</span>
            </div>
        </div>

        <div #linksContainer [class]="'links-container' + (showOthers ? ' active' : '')">
            <div *ngFor="let urlRow of urlRows; let i = index" [style.display]="'flex'" [style.justify-content]="i === 0 ? 'space-between' : 'center'">
            <ng-container *ngFor="let url of urlRow; let j = index">
                <!-- "" -->
                <a #a [href]="url.href || '#'" [target]="url.href ? '_blank' : ''" (click)="a.blur(); getActive(a)" (mouseleave)="getNotActive(a)" [class]="'themed-text ' + (!showOthers ? 'not-active' : '')">
                <moo-spaced [chars]="url.text" [style.margin-right]="j !== urlRow.length - 1 ? (url.margin + 'px') : 0"></moo-spaced>
                </a>
            </ng-container>
            </div>

            <div [style.visibility]="'hidden'" [style.position]="'absolute'">
            <moo-text-placement-test #placementTester [urls]="urls"></moo-text-placement-test>
            </div>
        </div>
        </div>

        <div [class]="'footer-container' + (showOthers ? ' active' : '')">
        <div class="footer">
            <div *ngFor="let url of footerUrls" class="footer-element-container">
            <div class="footer-element">
                <a #a [class]="'themed-text top-urls-justified' + (!showOthers ? ' not-active' : '')" [style.width]="'100%'" [href]="url.href || '#'" [target]="url.href.indexOf('mailto:') !== -1 || url.href.indexOf('tel:') !== -1 ? '' : '_blank'" (click)="a.blur(); getActive(a)" (mouseleave)="getNotActive(a)">
                <ng-container *ngFor="let char of url.text.split(''); let i = index">
                    <!-- "" -->
                    <ng-container *ngIf="char !== '\\'">
                    <span *ngIf="i > 0 && url.text.split('')[i - 1] === '\\' && char === 's'">
                        {{ ' ' }}
                    </span>
                    <span *ngIf="!i || url.text.split('')[i - 1] !== '\\'">
                        {{ char }}
                    </span>
                    </ng-container>
                </ng-container>
                </a>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>

    </div>
</ng-container>

<div #backgroundImageHolder class="background-image-holder">
</div>
